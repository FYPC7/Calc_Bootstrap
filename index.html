import React, { useState, useEffect } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LineChart, Line, ScatterChart, Scatter } from 'recharts';
import { Calculator, BarChart3, TrendingUp, Users, Target, Settings, Play, Download } from 'lucide-react';

const BootstrapApp = () => {
  const [selectedExercise, setSelectedExercise] = useState(1);
  const [confidenceLevel, setConfidenceLevel] = useState(95);
  const [bootstrapSamples, setBootstrapSamples] = useState(1000);
  const [results, setResults] = useState(null);
  const [loading, setLoading] = useState(false);
  const [inputData, setInputData] = useState({});

  // Datos predeterminados para cada ejercicio
  const defaultData = {
    1: { data: [502, 498, 505, 501, 499, 503, 497, 504, 500, 502, 498, 506, 499, 501, 504] },
    2: { 
      systemA: [120, 115, 125, 118, 122, 119, 123, 117, 121, 124],
      systemB: [135, 132, 138, 134, 136, 133, 139, 131, 137, 140]
    },
    3: { data: [1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1] },
    4: {
      hours: [2, 4, 3, 5, 1, 6, 3, 4, 2, 5, 7, 3, 4, 6, 2],
      grades: [65, 78, 72, 85, 58, 88, 70, 79, 63, 82, 92, 68, 75, 86, 61]
    },
    5: { data: [2.5, 3.2, 2.8, 3.5, 2.9, 3.1, 2.7, 3.4, 3.0, 3.3, 2.6, 3.6, 2.9, 3.2, 2.8, 3.1, 2.7, 3.3, 3.0, 2.9] }
  };

  // Función para generar números aleatorios
  const random = () => Math.random();

  // Función para calcular estadísticas básicas
  const calculateStats = (data) => {
    const sorted = [...data].sort((a, b) => a - b);
    const n = data.length;
    const mean = data.reduce((sum, val) => sum + val, 0) / n;
    const variance = data.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / (n - 1);
    const std = Math.sqrt(variance);
    const median = n % 2 === 0 ? (sorted[n/2 - 1] + sorted[n/2]) / 2 : sorted[Math.floor(n/2)];
    
    return { mean, variance, std, median, sorted, n };
  };

  // Función para realizar bootstrap
  const bootstrap = (data, statFunc, samples = 1000) => {
    const bootstrapStats = [];
    
    for (let i = 0; i < samples; i++) {
      const bootstrapSample = [];
      for (let j = 0; j < data.length; j++) {
        const randomIndex = Math.floor(random() * data.length);
        bootstrapSample.push(data[randomIndex]);
      }
      bootstrapStats.push(statFunc(bootstrapSample));
    }
    
    return bootstrapStats;
  };

  // Función para calcular intervalos de confianza
  const calculateCI = (bootstrapStats, confidence) => {
    const sorted = [...bootstrapStats].sort((a, b) => a - b);
    const alpha = (100 - confidence) / 2;
    const lowerIndex = Math.floor((alpha / 100) * sorted.length);
    const upperIndex = Math.floor(((100 - alpha) / 100) * sorted.length) - 1;
    
    return {
      lower: sorted[lowerIndex],
      upper: sorted[upperIndex],
      mean: sorted.reduce((sum, val) => sum + val, 0) / sorted.length
    };
  };

  // Función para ejecutar el ejercicio seleccionado
  const runExercise = () => {
    setLoading(true);
    
    setTimeout(() => {
      let result = {};
      
      switch (selectedExercise) {
        case 1: // Estimación de la media
          const data1 = inputData[1]?.data || defaultData[1].data;
          const stats1 = calculateStats(data1);
          const bootstrapMeans = bootstrap(data1, (sample) => calculateStats(sample).mean, bootstrapSamples);
          const meanCI = calculateCI(bootstrapMeans, confidenceLevel);
          
          result = {
            type: 'mean',
            originalMean: stats1.mean,
            bootstrapMean: meanCI.mean,
            confidenceInterval: meanCI,
            bootstrapStats: bootstrapMeans,
            originalData: data1
          };
          break;
          
        case 2: // Comparación de dos medias
          const systemA = inputData[2]?.systemA || defaultData[2].systemA;
          const systemB = inputData[2]?.systemB || defaultData[2].systemB;
          const statsA = calculateStats(systemA);
          const statsB = calculateStats(systemB);
          
          const bootstrapDiffs = [];
          for (let i = 0; i < bootstrapSamples; i++) {
            const sampleA = [];
            const sampleB = [];
            
            for (let j = 0; j < systemA.length; j++) {
              sampleA.push(systemA[Math.floor(random() * systemA.length)]);
            }
            for (let j = 0; j < systemB.length; j++) {
              sampleB.push(systemB[Math.floor(random() * systemB.length)]);
            }
            
            const meanA = calculateStats(sampleA).mean;
            const meanB = calculateStats(sampleB).mean;
            bootstrapDiffs.push(meanB - meanA);
          }
          
          const diffCI = calculateCI(bootstrapDiffs, confidenceLevel);
          
          result = {
            type: 'comparison',
            meanA: statsA.mean,
            meanB: statsB.mean,
            difference: statsB.mean - statsA.mean,
            confidenceInterval: diffCI,
            bootstrapStats: bootstrapDiffs,
            significant: !(diffCI.lower <= 0 && diffCI.upper >= 0)
          };
          break;
          
        case 3: // Estimación de proporciones
          const data3 = inputData[3]?.data || defaultData[3].data;
          const successes = data3.filter(x => x === 1).length;
          const proportion = successes / data3.length;
          
          const bootstrapProps = bootstrap(data3, (sample) => {
            const succ = sample.filter(x => x === 1).length;
            return succ / sample.length;
          }, bootstrapSamples);
          
          const propCI = calculateCI(bootstrapProps, confidenceLevel);
          
          result = {
            type: 'proportion',
            originalProportion: proportion,
            bootstrapProportion: propCI.mean,
            confidenceInterval: propCI,
            bootstrapStats: bootstrapProps,
            successes: successes,
            total: data3.length
          };
          break;
          
        case 4: // Correlación Bootstrap
          const hours = inputData[4]?.hours || defaultData[4].hours;
          const grades = inputData[4]?.grades || defaultData[4].grades;
          
          const calculateCorrelation = (x, y) => {
            const n = x.length;
            const meanX = x.reduce((sum, val) => sum + val, 0) / n;
            const meanY = y.reduce((sum, val) => sum + val, 0) / n;
            
            let numerator = 0;
            let denomX = 0;
            let denomY = 0;
            
            for (let i = 0; i < n; i++) {
              const dx = x[i] - meanX;
              const dy = y[i] - meanY;
              numerator += dx * dy;
              denomX += dx * dx;
              denomY += dy * dy;
            }
            
            return numerator / Math.sqrt(denomX * denomY);
          };
          
          const originalCorr = calculateCorrelation(hours, grades);
          
          const bootstrapCorrs = [];
          for (let i = 0; i < bootstrapSamples; i++) {
            const indices = [];
            for (let j = 0; j < hours.length; j++) {
              indices.push(Math.floor(random() * hours.length));
            }
            
            const bootstrapHours = indices.map(idx => hours[idx]);
            const bootstrapGrades = indices.map(idx => grades[idx]);
            
            bootstrapCorrs.push(calculateCorrelation(bootstrapHours, bootstrapGrades));
          }
          
          const corrCI = calculateCI(bootstrapCorrs, confidenceLevel);
          
          result = {
            type: 'correlation',
            originalCorrelation: originalCorr,
            bootstrapCorrelation: corrCI.mean,
            confidenceInterval: corrCI,
            bootstrapStats: bootstrapCorrs,
            scatterData: hours.map((h, i) => ({ x: h, y: grades[i] }))
          };
          break;
          
        case 5: // Mediana y Percentiles
          const data5 = inputData[5]?.data || defaultData[5].data;
          const stats5 = calculateStats(data5);
          
          const bootstrapMedians = bootstrap(data5, (sample) => calculateStats(sample).median, bootstrapSamples);
          const bootstrapQ25 = bootstrap(data5, (sample) => {
            const sorted = [...sample].sort((a, b) => a - b);
            return sorted[Math.floor(0.25 * sorted.length)];
          }, bootstrapSamples);
          const bootstrapQ75 = bootstrap(data5, (sample) => {
            const sorted = [...sample].sort((a, b) => a - b);
            return sorted[Math.floor(0.75 * sorted.length)];
          }, bootstrapSamples);
          
          const medianCI = calculateCI(bootstrapMedians, confidenceLevel);
          const q25CI = calculateCI(bootstrapQ25, confidenceLevel);
          const q75CI = calculateCI(bootstrapQ75, confidenceLevel);
          
          result = {
            type: 'percentiles',
            originalMedian: stats5.median,
            medianCI: medianCI,
            q25CI: q25CI,
            q75CI: q75CI,
            bootstrapStats: bootstrapMedians
          };
          break;
          
        default:
          result = { type: 'error', message: 'Ejercicio no implementado aún' };
      }
      
      setResults(result);
      setLoading(false);
    }, 1000);
  };

  const exercises = [
    { id: 1, title: 'Estimación de la Media', icon: Calculator, description: 'Pesos de productos manufacturados' },
    { id: 2, title: 'Comparación de Dos Medias', icon: BarChart3, description: 'Tiempo de respuesta de sistemas' },
    { id: 3, title: 'Estimación de Proporciones', icon: Target, description: 'Éxito en tratamiento médico' },
    { id: 4, title: 'Correlación Bootstrap', icon: TrendingUp, description: 'Horas de estudio vs calificaciones' },
    { id: 5, title: 'Mediana y Percentiles', icon: Users, description: 'Ingresos mensuales de empleados' }
  ];

  const handleDataInput = (exerciseId, field, value) => {
    const parsedValue = value.split(',').map(v => {
      const num = parseFloat(v.trim());
      return isNaN(num) ? 0 : num;
    });
    
    setInputData(prev => ({
      ...prev,
      [exerciseId]: {
        ...prev[exerciseId],
        [field]: parsedValue
      }
    }));
  };

  const renderDataInput = () => {
    switch (selectedExercise) {
      case 1:
        return (
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-purple-700 mb-2">
                Datos (separados por comas):
              </label>
              <textarea
                className="w-full p-3 border-2 border-purple-200 rounded-lg focus:border-purple-400 focus:outline-none"
                rows="3"
                placeholder="502, 498, 505, 501, 499, 503, 497, 504, 500, 502, 498, 506, 499, 501, 504"
                defaultValue={defaultData[1].data.join(', ')}
                onChange={(e) => handleDataInput(1, 'data', e.target.value)}
              />
            </div>
          </div>
        );
      case 2:
        return (
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-purple-700 mb-2">
                Sistema A (separados por comas):
              </label>
              <textarea
                className="w-full p-3 border-2 border-purple-200 rounded-lg focus:border-purple-400 focus:outline-none"
                rows="2"
                placeholder="120, 115, 125, 118, 122, 119, 123, 117, 121, 124"
                defaultValue={defaultData[2].systemA.join(', ')}
                onChange={(e) => handleDataInput(2, 'systemA', e.target.value)}
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-purple-700 mb-2">
                Sistema B (separados por comas):
              </label>
              <textarea
                className="w-full p-3 border-2 border-purple-200 rounded-lg focus:border-purple-400 focus:outline-none"
                rows="2"
                placeholder="135, 132, 138, 134, 136, 133, 139, 131, 137, 140"
                defaultValue={defaultData[2].systemB.join(', ')}
                onChange={(e) => handleDataInput(2, 'systemB', e.target.value)}
              />
            </div>
          </div>
        );
      case 3:
        return (
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-purple-700 mb-2">
                Datos (1 = éxito, 0 = fallo, separados por comas):
              </label>
              <textarea
                className="w-full p-3 border-2 border-purple-200 rounded-lg focus:border-purple-400 focus:outline-none"
                rows="3"
                placeholder="1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1"
                defaultValue={defaultData[3].data.join(', ')}
                onChange={(e) => handleDataInput(3, 'data', e.target.value)}
              />
            </div>
          </div>
        );
      case 4:
        return (
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-purple-700 mb-2">
                Horas de estudio (separadas por comas):
              </label>
              <textarea
                className="w-full p-3 border-2 border-purple-200 rounded-lg focus:border-purple-400 focus:outline-none"
                rows="2"
                placeholder="2, 4, 3, 5, 1, 6, 3, 4, 2, 5, 7, 3, 4, 6, 2"
                defaultValue={defaultData[4].hours.join(', ')}
                onChange={(e) => handleDataInput(4, 'hours', e.target.value)}
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-purple-700 mb-2">
                Calificaciones (separadas por comas):
              </label>
              <textarea
                className="w-full p-3 border-2 border-purple-200 rounded-lg focus:border-purple-400 focus:outline-none"
                rows="2"
                placeholder="65, 78, 72, 85, 58, 88, 70, 79, 63, 82, 92, 68, 75, 86, 61"
                defaultValue={defaultData[4].grades.join(', ')}
                onChange={(e) => handleDataInput(4, 'grades', e.target.value)}
              />
            </div>
          </div>
        );
      case 5:
        return (
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-purple-700 mb-2">
                Ingresos mensuales (en miles, separados por comas):
              </label>
              <textarea
                className="w-full p-3 border-2 border-purple-200 rounded-lg focus:border-purple-400 focus:outline-none"
                rows="3"
                placeholder="2.5, 3.2, 2.8, 3.5, 2.9, 3.1, 2.7, 3.4, 3.0, 3.3, 2.6, 3.6, 2.9, 3.2, 2.8, 3.1, 2.7, 3.3, 3.0, 2.9"
                defaultValue={defaultData[5].data.join(', ')}
                onChange={(e) => handleDataInput(5, 'data', e.target.value)}
              />
            </div>
          </div>
        );
      default:
        return <div className="text-pink-600">Selecciona un ejercicio para ingresar datos</div>;
    }
  };

  const renderResults = () => {
    if (!results) return null;

    const histogramData = results.bootstrapStats ? 
      results.bootstrapStats.slice(0, 50).map((value, index) => ({
        bin: index,
        value: value
      })) : [];

    switch (results.type) {
      case 'mean':
        return (
          <div className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="bg-gradient-to-br from-pink-100 to-pink-200 p-4 rounded-lg">
                <h4 className="font-semibold text-pink-800">Media Original</h4>
                <p className="text-2xl font-bold text-pink-900">{results.originalMean.toFixed(3)}</p>
              </div>
              <div className="bg-gradient-to-br from-purple-100 to-purple-200 p-4 rounded-lg">
                <h4 className="font-semibold text-purple-800">Media Bootstrap</h4>
                <p className="text-2xl font-bold text-purple-900">{results.bootstrapMean.toFixed(3)}</p>
              </div>
              <div className="bg-gradient-to-br from-blue-100 to-blue-200 p-4 rounded-lg">
                <h4 className="font-semibold text-blue-800">IC {confidenceLevel}%</h4>
                <p className="text-sm font-bold text-blue-900">
                  [{results.confidenceInterval.lower.toFixed(3)}, {results.confidenceInterval.upper.toFixed(3)}]
                </p>
              </div>
            </div>
            
            <div className="bg-white p-6 rounded-lg shadow-sm">
              <h4 className="text-lg font-semibold text-gray-800 mb-4">Distribución Bootstrap</h4>
              <ResponsiveContainer width="100%" height={300}>
                <BarChart data={histogramData}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="bin" />
                  <YAxis />
                  <Tooltip />
                  <Bar dataKey="value" fill="#8b5cf6" />
                </BarChart>
              </ResponsiveContainer>
            </div>
          </div>
        );
        
      case 'comparison':
        return (
          <div className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div className="bg-gradient-to-br from-green-100 to-green-200 p-4 rounded-lg">
                <h4 className="font-semibold text-green-800">Media A</h4>
                <p className="text-xl font-bold text-green-900">{results.meanA.toFixed(3)}</p>
              </div>
              <div className="bg-gradient-to-br from-orange-100 to-orange-200 p-4 rounded-lg">
                <h4 className="font-semibold text-orange-800">Media B</h4>
                <p className="text-xl font-bold text-orange-900">{results.meanB.toFixed(3)}</p>
              </div>
              <div className="bg-gradient-to-br from-purple-100 to-purple-200 p-4 rounded-lg">
                <h4 className="font-semibold text-purple-800">Diferencia</h4>
                <p className="text-xl font-bold text-purple-900">{results.difference.toFixed(3)}</p>
              </div>
              <div className={`bg-gradient-to-br p-4 rounded-lg ${results.significant ? 'from-red-100 to-red-200' : 'from-gray-100 to-gray-200'}`}>
                <h4 className={`font-semibold ${results.significant ? 'text-red-800' : 'text-gray-800'}`}>
                  Significativo
                </h4>
                <p className={`text-xl font-bold ${results.significant ? 'text-red-900' : 'text-gray-900'}`}>
                  {results.significant ? 'SÍ' : 'NO'}
                </p>
              </div>
            </div>
          </div>
        );
        
      case 'proportion':
        return (
          <div className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="bg-gradient-to-br from-teal-100 to-teal-200 p-4 rounded-lg">
                <h4 className="font-semibold text-teal-800">Proporción Original</h4>
                <p className="text-2xl font-bold text-teal-900">{(results.originalProportion * 100).toFixed(1)}%</p>
                <p className="text-sm text-teal-700">{results.successes}/{results.total}</p>
              </div>
              <div className="bg-gradient-to-br from-indigo-100 to-indigo-200 p-4 rounded-lg">
                <h4 className="font-semibold text-indigo-800">Proporción Bootstrap</h4>
                <p className="text-2xl font-bold text-indigo-900">{(results.bootstrapProportion * 100).toFixed(1)}%</p>
              </div>
              <div className="bg-gradient-to-br from-pink-100 to-pink-200 p-4 rounded-lg">
                <h4 className="font-semibold text-pink-800">IC {confidenceLevel}%</h4>
                <p className="text-sm font-bold text-pink-900">
                  [{(results.confidenceInterval.lower * 100).toFixed(1)}%, {(results.confidenceInterval.upper * 100).toFixed(1)}%]
                </p>
              </div>
            </div>
          </div>
        );
        
      case 'correlation':
        return (
          <div className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="bg-gradient-to-br from-rose-100 to-rose-200 p-4 rounded-lg">
                <h4 className="font-semibold text-rose-800">Correlación Original</h4>
                <p className="text-2xl font-bold text-rose-900">{results.originalCorrelation.toFixed(3)}</p>
              </div>
              <div className="bg-gradient-to-br from-violet-100 to-violet-200 p-4 rounded-lg">
                <h4 className="font-semibold text-violet-800">Correlación Bootstrap</h4>
                <p className="text-2xl font-bold text-violet-900">{results.bootstrapCorrelation.toFixed(3)}</p>
              </div>
              <div className="bg-gradient-to-br from-cyan-100 to-cyan-200 p-4 rounded-lg">
                <h4 className="font-semibold text-cyan-800">IC {confidenceLevel}%</h4>
                <p className="text-sm font-bold text-cyan-900">
                  [{results.confidenceInterval.lower.toFixed(3)}, {results.confidenceInterval.upper.toFixed(3)}]
                </p>
              </div>
            </div>
            
            <div className="bg-white p-6 rounded-lg shadow-sm">
              <h4 className="text-lg font-semibold text-gray-800 mb-4">Diagrama de Dispersión</h4>
              <ResponsiveContainer width="100%" height={300}>
                <ScatterChart>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="x" name="Horas" />
                  <YAxis dataKey="y" name="Calificaciones" />
                  <Tooltip />
                  <Scatter data={results.scatterData} fill="#8b5cf6" />
                </ScatterChart>
              </ResponsiveContainer>
            </div>
          </div>
        );
        
      case 'percentiles':
        return (
          <div className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div className="bg-gradient-to-br from-amber-100 to-amber-200 p-4 rounded-lg">
                <h4 className="font-semibold text-amber-800">Percentil 25</h4>
                <p className="text-xl font-bold text-amber-900">{results.q25CI.mean.toFixed(3)}</p>
                <p className="text-xs text-amber-700">
                  IC: [{results.q25CI.lower.toFixed(3)}, {results.q25CI.upper.toFixed(3)}]
                </p>
              </div>
              <div className="bg-gradient-to-br from-emerald-100 to-emerald-200 p-4 rounded-lg">
                <h4 className="font-semibold text-emerald-800">Mediana (P50)</h4>
                <p className="text-xl font-bold text-emerald-900">{results.originalMedian.toFixed(3)}</p>
                <p className="text-xs text-emerald-700">
                  IC: [{results.medianCI.lower.toFixed(3)}, {results.medianCI.upper.toFixed(3)}]
                </p>
              </div>
              <div className="bg-gradient-to-br from-sky-100 to-sky-200 p-4 rounded-lg">
                <h4 className="font-semibold text-sky-800">Percentil 75</h4>
                <p className="text-xl font-bold text-sky-900">{results.q75CI.mean.toFixed(3)}</p>
                <p className="text-xs text-sky-700">
                  IC: [{results.q75CI.lower.toFixed(3)}, {results.q75CI.upper.toFixed(3)}]
                </p>
              </div>
            </div>
          </div>
        );
        
      default:
        return <div className="text-red-600">Error: {results.message}</div>;
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-blue-50 p-4">
      <div className="max-w-7xl mx-auto">
        <header className="text-center mb-8">
          <h1 className="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">
            Aplicación Bootstrap Estadística
          </h1>
          <p className="text-gray-600">Análisis interactivo de datos con métodos de remuestreo</p>
        </header>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Panel de Selección */}
          <div className="lg:col-span-1 space-y-6">
            <div className="bg-white/70 backdrop-blur-sm rounded-xl p-6 shadow-sm">
              <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <Settings className="mr-2 text-purple-600" />
                Configuración
              </h2>
              
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Nivel de Confianza (%):
                  </label>
                  <select
                    value={confidenceLevel}
                    onChange={(e) => setConfidenceLevel(Number(e.target.value))}
                    className="w-full p-3 border-2 border-purple-200 rounded-lg focus:border-purple-400 focus:outline-none bg-white"
                  >
                    <option value={90}>90%</option>
                    <option value={95}>95%</option>
                    <option value={99}>99%</option>
                  </select>
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Muestras Bootstrap:
                  </label>
                  <select
                    value={bootstrapSamples}
                    onChange={(e) => setBootstrapSamples(Number(e.target.value))}
                    className="w-full p-3 border-2 border-purple-200 rounded-lg focus:border-purple-400 focus:outline-none bg-white"
                  >
                    <option value={500}>500</option>
                    <option value={1000}>1000</option>
                    <option value={2000}>2000</option>
                    <option value={5000}>5000</option>
                  </select>
                </div>
              </div>
            </div>

            <div className="bg-white/70 backdrop-blur-sm rounded-xl p-6 shadow-sm">
              <h2 className="text-xl font-semibold text-gray-800 mb-4">Ejercicios</h2>
              <div className="space-y-2">
                {exercises.map((exercise) => {
                  const Icon = exercise.icon;
                  return (
                    <button
                      key={exercise.id}
                      onClick={() => setSelectedExercise(exercise.id)}
                      className={`w-full p-4 text-left rounded-lg transition-all duration-200 ${
                        selectedExercise === exercise.id
                          ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg'
                          : 'bg-white/50 hover:bg-white/80 text-gray-700'
                      }`}
                    >
                      <div className="flex items-center space-x-3">
                        <Icon size={20} />
                        <div>
                          <div className="font-semibold text-sm">{exercise.title}</div>
                          <div className="text-xs opacity-75">{exercise.description}</div>
                        </div>
                      </div>
                    </button>
                  );
                })}
              </div>
            </div>
          </div>

          {/* Panel Principal */}
          <div className="lg:col-span-2 space-y-6">
            <div className="bg-white/70 backdrop-blur-sm rounded-xl p-6 shadow-sm">
              <h2 className="text-xl font-semibold text-gray-800 mb-4">
                {exercises.find(e => e.id === selectedExercise)?.title}
              </h2>
              <p className="text-gray-600 mb-6">
                {exercises.find(e => e.id === selectedExercise)?.description}
              </p>
              
              {renderDataInput()}
              
              <div className="mt-6 flex space-x-4">
                <button
                  onClick={runExercise}
                  disabled={loading}
                  className="flex items-center space-x-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                >
                  <Play size={20} />
                  <span>{loading ? 'Calculando...' : 'Ejecutar Bootstrap'}</span>
                </button>
                
                {results && (
                  <button
                    onClick={() => {
                      const dataStr = JSON.stringify(results, null, 2);
                      const blob = new Blob([dataStr], { type: 'application/json' });
                      const url = URL.createObjectURL(blob);
                      const a = document.createElement('a');
                      a.href = url;
                      a.download = `bootstrap_results_exercise_${selectedExercise}.json`;
                      a.click();
                      URL.revokeObjectURL(url);
                    }}
                    className="flex items-center space-x-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-6 py-3 rounded-lg hover:from-blue-600 hover:to-cyan-600 transition-all duration-200 shadow-lg"
                  >
                    <Download size={20} />
                    <span>Descargar Resultados</span>
                  </button>
                )}
              </div>
            </div>

            {/* Panel de Resultados */}
            {results && (
              <div className="bg-white/70 backdrop-blur-sm rounded-xl p-6 shadow-sm">
                <h2 className="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                  <BarChart3 className="mr-2 text-purple-600" />
                  Resultados del Análisis Bootstrap
                </h2>
                {renderResults()}
              </div>
            )}

            {/* Panel de Información */}
            <div className="bg-white/70 backdrop-blur-sm rounded-xl p-6 shadow-sm">
              <h3 className="text-lg font-semibold text-gray-800 mb-4">Información del Método Bootstrap</h3>
              <div className="space-y-4 text-sm text-gray-600">
                <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg">
                  <h4 className="font-semibold text-blue-800 mb-2">¿Qué es Bootstrap?</h4>
                  <p>
                    Bootstrap es un método de remuestreo que permite estimar la distribución de un estadístico 
                    mediante la generación de múltiples muestras aleatorias con reemplazo de los datos originales.
                  </p>
                </div>
                
                <div className="bg-gradient-to-r from-green-50 to-teal-50 p-4 rounded-lg">
                  <h4 className="font-semibold text-green-800 mb-2">Ventajas del Bootstrap</h4>
                  <ul className="list-disc list-inside space-y-1">
                    <li>No requiere supuestos distribucionales</li>
                    <li>Proporciona intervalos de confianza robustos</li>
                    <li>Funciona con muestras pequeñas</li>
                    <li>Aplicable a cualquier estadístico</li>
                  </ul>
                </div>
                
                <div className="bg-gradient-to-r from-pink-50 to-rose-50 p-4 rounded-lg">
                  <h4 className="font-semibold text-pink-800 mb-2">Interpretación de Resultados</h4>
                  <p>
                    Los intervalos de confianza bootstrap indican el rango de valores plausibles para el parámetro 
                    poblacional con un nivel de confianza específico. Si el intervalo no contiene cero (para diferencias), 
                    sugiere significancia estadística.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <footer className="text-center mt-12 text-gray-500 text-sm">
          <p>Aplicación Bootstrap Estadística - Análisis de Datos Interactivo</p>
          <p className="mt-1">Desarrollado con React y métodos de remuestreo estadístico</p>
        </footer>
      </div>
    </div>
  );
};

export default BootstrapApp;
